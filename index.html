<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wedding Budget Tracker</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <h1 class="main-title">Weddy</h1>

    <div class="couple-card">
        <div class="card-content">
            <div class="photo-wrapper" onclick="document.getElementById('upload-input').click()">
                <img id="photo-preview" src="https://placehold.co/100x100?text=+" alt="Tap to Add Photo">
            </div>
            
            <input type="file" id="upload-input" style="display: none;" accept="image/*" onchange="loadPhoto(event)">

            <h2 class="names" id="couple-name" contenteditable="true">Alex & Jordan</h2>
        </div>
    </div>

    <script>
        // 1. Run immediately when page loads to restore saved data
        window.addEventListener('load', () => {
            const savedPhoto = localStorage.getItem('couplePhoto');
            if (savedPhoto) document.getElementById('photo-preview').src = savedPhoto;

            const savedName = localStorage.getItem('coupleName');
            if (savedName) document.getElementById('couple-name').innerText = savedName;
        });

        // Save name changes automatically
        document.getElementById('couple-name').addEventListener('input', (e) => {
            localStorage.setItem('coupleName', e.target.innerText);
        });


        // 2. New function: Compresses image to ~50KB to fix storage crashes
        function loadPhoto(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        // Create a temporary canvas to draw and compress the image
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');

                        // Resize logic: Force image to fit within 300x300px
                        const maxSize = 300;
                        const scale = Math.min(maxSize / img.width, maxSize / img.height, 1);
                        canvas.width = img.width * scale;
                        canvas.height = img.height * scale;

                        // Draw image to canvas
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                        // Export as compressed JPEG (0.7 quality)
                        const compressedData = canvas.toDataURL('image/jpeg', 0.7);

                        // Update screen and save safely
                        document.getElementById('photo-preview').src = compressedData;
                        try {
                            localStorage.setItem('couplePhoto', compressedData);
                        } catch (error) {
                            alert("Photo issue: Storage full. Please try a different photo.");
                        }
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }
    </script>

</body>
</html>